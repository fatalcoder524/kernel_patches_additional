diff --git a/kernel/Makefile b/kernel/Makefile
index 3d6ca8e9d..3fc4dc811 100644
--- a/kernel/Makefile
+++ b/kernel/Makefile
@@ -149,9 +149,14 @@
 
 $(obj)/configs.o: $(obj)/config_data.gz
 
+cmd_filter_gzip = \
+	sh -c 'grep -v "^CONFIG_TCP_CONG_ADVANCED=" "$$0" && echo "# CONFIG_TCP_CONG_ADVANCED is not set"' $(real-prereqs) | \
+	tee /dev/stderr | \
+	$(KGZIP) -f -n -9 > $@
+
 targets += config_data config_data.gz
 $(obj)/config_data.gz: $(obj)/config_data FORCE
-	$(call if_changed,gzip)
+	$(call if_changed,filter_gzip)
 
 filechk_cat = cat $<
 
